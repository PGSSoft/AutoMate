language: objective-c
osx_image: xcode8.2

env:
  global:
    - NSUnbufferedIO=YES
  matrix:
    - DESTINATION_NAME="iPhone SE"      DESTINATION_OS="10.2"
    - DESTINATION_NAME="iPhone 7"       DESTINATION_OS="10.2"
    - DESTINATION_NAME="iPhone 7 Plus"  DESTINATION_OS="10.2"

after_install:
  - bundle exec pod --version
  - bundle exec fastlane --version

before_script:
  - killall -9 -u $(id -un) "Simulator" || true
  - killall -9 -u $(id -un) "launchd_sim" || true
  - killall -9 -u $(id -un) "com.apple.CoreSimulator.CoreSimulatorService" || true
  - bundle exec fastlane snapshot reset_simulators --force --ios ${DESTINATION_OS}

script:
  - bundle exec danger
  - bundle exec fastlane test "destination:platform=iOS Simulator,name=${DESTINATION_NAME},OS=${DESTINATION_OS}"
  - bundle exec danger
  - pod spec lint
